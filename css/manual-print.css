/* ===========================
   印刷スタイル: manual-print.css
   =========================== */
/*
  構成
  1) 基本設定（印刷品質/ページ余白/非表示UI/レイアウト解除）
  2) 表紙ページ
  3) 本文（全章出力・見出し/分割抑制/画像等の最小調整）
  4) 画面構成セクションの印刷専用調整
  5) 印刷用目次のリンクスタイル
  6) TOPページ完全非表示と改ページ調整
  7) OSSライセンス表（印刷時の全件表示と中央寄せ）
*/

/* 画面では印刷専用要素を隠す */
.only-print { display: none !important; }

/* 画面側との干渉回避：表紙を入れたせいで :first-of-type 調整が崩れる場合の軽微な補正 */
.print-cover + .step-section { margin-top: 8px; }

/* 印刷用: すべての章を出力、表紙→改ページ→本文 */
@media print {
  /* ===== 1) 基本設定 ===== */
  /* 高品質印刷 */
  :root {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color-adjust: exact;
  }

  /* セクションカウンターの初期化 */
  body {
    counter-reset: section-counter;
  }

  /* 用紙と余白 */
  @page {
    size: A4;
    margin: 14mm 16mm;
  }

  /* レイアウトのフレックス/固定高を解除して自然に縦積み */
  .manual-wrapper,
  .manual-content,
  .content-panel {
    display: block !important;
    height: auto !important;
    overflow: visible !important;
  }

  /* 画面専用UIは非表示 */
  .hamburger-menu,
  .menu-overlay,
  .manual-sidebar,
  .sub-items-panel,
  .content-tabs,
  .breadcrumb,
  .version-info {
    display: none !important;
  }

  /* 画面用の余白は印刷ではリセット */
  .manual-content {
    padding: 0 !important;
    margin: 0 !important;
    gap: 0 !important;
    border: 0 !important;
  }

  /* ===== 2) 表紙 ===== */
  .print-cover.only-print {
    display: block !important;
    page-break-after: always;
    text-align: center;
    padding-top: 35mm;
  }
  .print-cover.only-print img {
    display: block;
    max-width: 60%;
    height: auto;
    margin: 0 auto 12mm;
  }
  .print-cover.only-print h1 {
    font-size: 22pt;
    margin: 0;
    font-weight: 700;
    color: #0b0b0b;
  }

  /* ===== 3) 本文全章を印刷 ===== */
  /* 画面では隠しているセクションも印刷時は全部表示 */
  .step-section {
    display: block !important;
    background: transparent !important;
    border: 0 !important;
    box-shadow: none !important;
    margin: 0 0 10mm !important;
    padding: 10mm !important;
    break-inside: avoid;
  }

  /* 章ごとに改ページ */
  .step-section + .step-section {
    break-before: page;
  }

  /* 隠されているセクションも印刷時は表示 */
  .step-section.is-hidden {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    height: auto !important;
    overflow: visible !important;
    padding: 10mm !important;
  }

  /* セクション内のコンテンツも確実に表示 */
  .step-content,
  .procedure-item,
  .procedure-steps {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* 各セクションの見出しを強制表示 */
  .step-section .step-header {
    display: block !important;
    visibility: visible !important;
  }

  /* 見出しブロックは途中で分割しない */
  .step-header {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }

  /* セクション見出しの余白を印刷向けに */
  .step-header h2 {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    font-size: 16pt !important;
    margin: 0 0 6mm !important;
    color: #0071B8 !important;
    page-break-after: avoid !important;
  }

  /* h2見出しを確実に表示 */
  .step-section h2,
  .step-header h2 {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    font-size: 16pt !important;
    margin: 0 0 6mm !important;
    color: #0b0b0b !important;
    page-break-after: avoid !important;
  }

  /* インラインスタイルを上書き */
  h2[style*="display: none"],
  h2[style*="visibility: hidden"] {
    display: block !important;
    visibility: visible !important;
  }

  /* セクション全体の表示を強制 */
  section[style*="display: none"],
  section[style*="visibility: hidden"] {
    display: block !important;
    visibility: visible !important;
  }

  /* 小見出しや本文の最小調整 */
  .step-objective {
    background: transparent !important;
    margin: 0 0 6mm !important;
    padding: 0 !important;
    border: 0 !important;
  }

  /* 手順項目のElevationを削除 */
  .procedure-item {
    box-shadow: none !important;
    background: transparent !important;
    border: 0 !important;
  }
  .step-content h3 {
    font-size: 12pt !important;
    margin: 0 0 4mm !important;
    padding: 0 0 2mm !important;
    border-bottom: 1px solid #ddd !important;
  }

  /* 画像は枠線なしで最大幅 */
  .procedure-image {
    border: 0 !important;
    box-shadow: none !important;
    margin: 0 0 4mm !important;
  }
  .procedure-image img {
    width: 100% !important;
    height: auto !important;
  }

  /* リンクの装飾は印刷では邪魔なので除去 */
  a {
    color: inherit !important;
    text-decoration: none !important;
  }

  /* ===== 4) 画面構成セクションの印刷時レイアウト（画像を先に表示） ===== */
  #screen-layout .step-with-image {
    display: flex !important;
    flex-direction: column !important;
    grid-template-columns: unset !important;
    grid-template-rows: unset !important;
  }

  #screen-layout .step-with-image .step-image {
    order: -1 !important;
    margin-bottom: 4mm !important;
    width: 100% !important;
    display: block !important;
  }

  #screen-layout .step-with-image .step-text {
    order: 1 !important;
    width: 100% !important;
    display: block !important;
  }

  #screen-layout .step-with-image .note-card {
    order: 2 !important;
    margin-top: 4mm !important;
  }

  #screen-layout .step-with-image .step-advice {
    order: 3 !important;
  }

  /* 画像の表示を確実に */
  #screen-layout .step-image img {
    width: 100% !important;
    height: auto !important;
    display: block !important;
  }

  /* ===== 5) 印刷用目次のリンクスタイル ===== */
  .print-toc-content a {
    color: var(--color-primary) !important;
    text-decoration: none !important;
  }

  .print-toc-section h3 a {
    color: #0b0b0b !important;
    font-weight: 600 !important;
  }

  .print-toc-sublist a {
    color: #333 !important;
  }

  /* ===== 6) TOPページの最終的な非表示設定（最高優先度） ===== */
  .step-section--top,
  #top.step-section--top,
  section#top,
  #top,
  [id="top"],
  .content-panel > #top {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    width: 0 !important;
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
    position: absolute !important;
    left: -9999px !important;
    top: -9999px !important;
  }

  /* TOPページ内のすべての要素も非表示 */
  #top *,
  .step-section--top * {
    display: none !important;
    visibility: hidden !important;
  }

  /* TOPページ関連の要素もすべて非表示 */
  .step-section--top::after,
  .step-section--top .top-hero,
  .step-section--top .step-header,
  .top-hero__lead,
  .top-feature-grid,
  .top-feature-card,
  .top-feature-icon,
  .top-feature-link {
    display: none !important;
    visibility: hidden !important;
  }

  /* TOPページの次の要素の改ページを調整 */
  #top + .step-section,
  .step-section--top + .step-section {
    page-break-before: auto !important;
    break-before: auto !important;
    margin-top: 0 !important;
  }

  /* ===== 7) OSSライセンス表（印刷時の全件表示と中央寄せ） ===== */
  /* 画面時のflexを解除して印刷時は通常のブロックレイアウトに */
  .step-text {
    display: block !important;
  }

  .oss-license-table tbody tr.oss-row-hidden {
    display: table-row !important;
  }

  .oss-table-toggle {
    display: none !important;
  }

  /* ライセンス表の中央寄せと紙面幅への最適化 */
  .oss-license-table {
    max-width: 160mm !important;
    width: 100% !important;
    display: block !important;
    margin: 0 auto !important;
  }

  /* ライセンス見出し直下の表だけを厳密に中央寄せ */
  h4#oss-licenses + .procedure-steps .step-text {
    text-align: center !important;
  }
  h4#oss-licenses + .procedure-steps .step-text .oss-license-table {
    display: inline-table !important;
    width: auto !important;
    max-width: 160mm !important;
    margin: 0 auto !important;
    text-align: left !important;
  }
}

/* 印刷用目次のリンクスタイル（画面表示時） */
@media screen {
  .print-toc-content a:hover {
    text-decoration: underline !important;
  }
}
